import hash_db
import hashlib
import virus_total
import math 


def check_malware(file_content, file_name):
    hash = hash_file(file_content)
    if hash in hash_db.content_array:
        return True
    else :
        result1 = virus_total.virusTotal(hash)
        if result1 == True:
            return True
        else:
            result2 = check_entropy(file_content)
            if result2 == True:
                return True 



def hash_file(file_content):
    hash_file = hashlib.sha256(file_content)
    hashed_file = hash_file.hexdigest
    return hash_file

def check_entropy(content):
    byte_count = [0]*256

    for b in content:
        byte_count[b] += 1

    entropy = 0
    for count in byte_count:
        if count == 0:
            continue
        p_x = count / len(content)
        entropy -= p_x  * math.log2(p_x)
    
    if entropy >= 6.5:
        return True 
    else :
        return False 

